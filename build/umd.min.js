(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Kubox=e()})(this,function(){"use strict";function t(t){return t.replace(/[\s\t\n\-\_]+(\w)/g,function(t,e){return e.toUpperCase()})}var e=function(t,e){void 0===t&&(t={}),void 0===e&&(e={}),this.state=t,this.actions={},this.subscribers={},this.reducers(e)};return e.prototype.update=function(t){var e=this;if("object"==typeof t){var n=Object.keys(t);n.length&&(this.state=Object.assign({},this.state,t),n.concat("*").forEach(function(t){var n=e.subscribers[t]||[];n.forEach(function(t){return t(e.state)})}))}},e.prototype.subscribe=function t(e,n){if(void 0===n&&(n="*"),"function"==typeof e){var t=this.subscribers[n]=this.subscribers[n]||[];return t.push(e),function(){t.splice(t.indexOf(e)>>>0,1)}}},e.prototype.reducers=function(t,e){var n=this;if(void 0===e&&(e=""),"object"==typeof t)for(var r in t){var o=n.nameSpace(e,r),i=t[r];"object"==typeof i&&n.reducers(i,o),"function"==typeof i&&(n.actions[o]=n.createReducer(i,e))}},e.prototype.getState=function(t){return t?this.state[t]:this.state},e.prototype.nameSpace=function(e,n){return t(e+(e?" ":"")+n)},e.prototype.createReducer=function(t,e){var n=this;return function(){for(var r=[],o=arguments.length;o--;)r[o]=arguments[o];return n.recycle(t.apply(void 0,[n.getState(e)].concat(r)),function(t){var r;n.update(e?(r={},r[e]=t,r):t)},e)}},e.prototype.recycle=function(t,e,n){var r=this;if("object"==typeof t){if("function"==typeof t.then)return void t.then(function(t){return r.recycle(t,e,n)});if("function"==typeof t.next){var o=t.next(this.getState(n));return void(o.done||this.recycle(o.value,function(o){e(o),r.recycle(t,e,n)}))}}e(t)},e});