"use strict";function toCamelCase(t){return t.replace(/[\s\t\n\-\_]+(\w)/g,function(t,e){return e.toUpperCase()})}var Store=function(t,e){void 0===t&&(t={}),void 0===e&&(e={}),this.state=t,this.actions={},this.subscribers={},this.reducers(e)};Store.prototype.update=function(t){var e=this;if("object"==typeof t){var r=Object.keys(t);r.length&&(this.state=Object.assign({},this.state,t),r.concat("*").forEach(function(t){var r=e.subscribers[t]||[];r.forEach(function(t){return t(e.state)})}))}},Store.prototype.subscribe=function t(e,r){if(void 0===r&&(r="*"),"function"==typeof e){var t=this.subscribers[r]=this.subscribers[r]||[];return t.push(e),function(){t.splice(t.indexOf(e)>>>0,1)}}},Store.prototype.reducers=function(t,e){var r=this;if(void 0===e&&(e=""),"object"==typeof t)for(var o in t){var n=r.nameSpace(e,o),c=t[o];"object"==typeof c&&r.reducers(c,n),"function"==typeof c&&(r.actions[n]=r.createReducer(c,e))}},Store.prototype.getState=function(t){return t?this.state[t]:this.state},Store.prototype.nameSpace=function(t,e){return toCamelCase(t+(t?" ":"")+e)},Store.prototype.createReducer=function(t,e){var r=this;return function(){for(var o=[],n=arguments.length;n--;)o[n]=arguments[n];return r.recycle(t.apply(void 0,[r.getState(e)].concat(o)),function(t){var o;r.update(e?(o={},o[e]=t,o):t)},e)}},Store.prototype.recycle=function(t,e,r){var o=this;if("object"==typeof t){if("function"==typeof t.then)return void t.then(function(t){return o.recycle(t,e,r)});if("function"==typeof t.next){var n=t.next(this.getState(r));return void(n.done||this.recycle(n.value,function(n){e(n),o.recycle(t,e,r)}))}}e(t)},module.exports=Store;